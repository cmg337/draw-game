<!DOCTYPE html>
<html>
<head>
    <title>Draw Game</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
</head>
<body>
    <header>
        <h1>
            Draw Game
        </h1>
    </header>
    <canvas id="canvas" width=1000 height=700>
    </canvas>

    <style>
        #canvas{
            border: 2px solid blue;
        }
        header{
            text-align: center;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.2/socket.io.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
        $(function () {
            var socket = io();
            var canvas = document.getElementById('canvas');                         
            var context = canvas.getContext('2d');
            var mouseIsDown = false;
            //create rect in canvas to draw on
            var width = canvas.width;
            var height = canvas.height;
            context.fillStyle = "white";
            context.fillRect(0, 0, width, height);
            console.log(canvas);

            function sleep(ms) {
              return new Promise(resolve => setTimeout(resolve, ms));
            }

            var mouse = {
                x: 0,
                y: 0
            };
            var element = null;

            function setMousePosition(e) {
                var ev = e || window.event; //Moz || IE
                if (ev.pageX) { //Moz
                    mouse.x = ev.pageX + window.pageXOffset - canvas.offsetLeft;
                    mouse.y = ev.pageY + window.pageYOffset - canvas.offsetTop;
                } else if (ev.clientX) { //IE
                    mouse.x = ev.clientX + document.body.scrollLeft - canvas.offsetLeft;
                    mouse.y = ev.clientY + document.body.scrollTop - canvas.offsetTop;
                }
            }

            canvas.onmousemove = function (e) {
                setMousePosition(e);
                //if (element !== null) {
                //    element.style.width = Math.abs(mouse.x - mouse.startX) + 'px';
                //    element.style.height = Math.abs(mouse.y - mouse.startY) + 'px';
                //    element.style.left = (mouse.x - mouse.startX < 0) ? mouse.x + 'px' : mouse.startX + 'px';
                //    element.style.top = (mouse.y - mouse.startY < 0) ? mouse.y + 'px' : mouse.startY + 'px';
                //}
            }

            canvas.onmousedown = async function (e) {
                console.log("begun.");
                mouseIsDown = true;
                var imgd;
                var thickness = 10;
                while (mouseIsDown) {
                    imgd = context.getImageData(mouse.x - thickness/2, mouse.y - thickness/2,  thickness, thickness);
                     
                    // Loop over each pixel and invert the color.
                    for (var i = 0, n = imgd.data.length; i < n; i += 4) {
	                    imgd.data[i  ] = 0; // red
	                    imgd.data[i+1] = 0; // green
	                    imgd.data[i+2] = 255; // blue
	                    // i+3 is alpha (the fourth element)
                    }

                    // Draw the ImageData at the given (x,y) coordinates.
                    context.putImageData(imgd, mouse.x - thickness/2, mouse.y - thickness/2);
                    await sleep();
                }
            }
            canvas.onmouseup = function (e) {
                console.log('end')
                mouseIsDown = false;
            }
            canvas.onmouseleave = function (e) {
                console.log('end')
                mouseIsDown = false;
            }

        });
    </script>
</body>
</html>

